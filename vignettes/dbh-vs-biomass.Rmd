---
title: "Plot dbh vs. biomass by species"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tidyverse)
library(fgeo.biomass)
```

### [Issue](https://github.com/forestgeo/allodb/issues/73)

> We'll want to make the following plot:
> * x-axis: DBH (cm)
> * y-axis: biomass (kg)
> * one colored line or series of points for each species at a site.

> [Example] for SCBI, with the modification that I'd like a separate color for each species + legend.

![](https://i.imgur.com/9yHG00Z.png)


### Introduction

Here I make this plot for the species we can get a meaningful biomass right now. Some species will be left out because fgeo.biomass can't handle them until I we support some additional issues.

I prefer to now wait and instead plot `dbh` vs. `biomass` as early as possible hoping that this will estimulate your review. Your continuous feedback is crucial in accelerating the development process.

### Data

I'll pick a subset of data from SCBI that I can use to get meaningful biomass even with the limited features that fgeo.biomass supports right now.

fgeo.biomass still has no way to [fall back to more generic equations when species-level equations are not available](https://github.com/forestgeo/allodb/issues/72).

```{r}
# Find species for which allodb has equations
available_species_equations <- allodb::master() %>% 
  filter(site == "SCBI") %>% 
  pull(species) %>% 
  unique() %>% 
  tolower()

# Add species to census data
census <- fgeo.biomass::scbi_tree1 %>% 
  add_species(fgeo.biomass::scbi_species, site = "SCBI")

# Pick census data for which allodb has equations
census1 <- census %>%
  filter(sp %in% available_species_equations)

census1
```

For now, [fgeo.biomass does not support allometric equations that are not at the level of an entire tree](https://github.com/forestgeo/allodb/issues/63).

```{r, cache=TRUE}
with_equations <- census1 %>% 
  allo_find()
```



Also, fgeo.biomass does no support equations that apply to different dbh ranges.
