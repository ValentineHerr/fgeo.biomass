<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculate Biomass with the Best Available Allometries • fgeo.biomass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Calculate Biomass with the Best Available Allometries">
<meta property="og:description" content="Calculate biomass with the best available
    allometries.  allodb package.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fgeo.biomass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maurolepore">
    <span class="fa fa-gavel"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/forestgeo/fgeo.biomass">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forestgeo.github.io/fgeo/">fgeo</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="calculate-biomass" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#calculate-biomass" class="anchor"></a><img src="https://i.imgur.com/vTLlhbp.png" align="right" height="88"> Calculate biomass</h1></div>

<p>The goal of <strong>fgeo.biomass</strong> is to calculate biomass using best available allometric-equations from the <a href="https://forestgeo.github.io/allodb/"><strong>allodb</strong></a> package.</p>
<div id="warning" class="section level2">
<h2 class="hasAnchor">
<a href="#warning" class="anchor"></a>Warning</h2>
<p>This package is not ready for research. We are now building a <a href="https://en.wikipedia.org/wiki/Minimum_viable_product">Minimum Viable Product</a>, with just enough features to collect feedback from alpha users and redirect our effort. The resulting biomass is still meaningless. For a working product see the <a href="https://CRAN.R-project.org/package=BIOMASS">BIOMASS</a> package.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install the development version of <strong>fgeo.biomass</strong> with:</p>
<pre><code><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports"># install.packages("devtools")
devtools::install_github("forestgeo/fgeo.biomass")</a></code></pre>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>In addition to <strong>fgeo.biomass</strong>, here we will use some other general purpose packages for manipulating data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fgeo.biomass)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</a></code></pre></div>
<p>As an example, we will use census and species datasets from the ForestGEO plot at the <a href="https://forestgeo.si.edu/sites/north-america/smithsonian-conservation-biology-institute">Smithsonian Conservation Biology Institute</a> (SCBI). This is a relatively large dataset. For a quick example we’ll pick just a few rows.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">census &lt;-<span class="st"> </span>fgeo.biomass<span class="op">::</span>scbi_tree1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="co"># Pick a few rows for speed</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample_n</a></span>(<span class="dv">5000</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">census</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; # A tibble: 5,000 x 20</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;    treeID stemID tag   StemTag sp    quadrat    gx    gy DBHID CensusID</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;     &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  1   5665   5665 42179 1       nysy  0422     78.7 425.   9171        1</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  2  28317  28317 1907… 1       frni  1912    378   238.  36867        1</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  3  17711  17711 1307… 1       caca  1308    246.  140.  23909        1</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  4  17546  17546 1305… 1       libe  1304    245.   75.1 23688        1</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  5  10668  10668 90418 1       caca  0904    168.   77   15257        1</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;  6   2417   2417 20154 1       libe  0203     31.4  40.6  5133        1</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;  7  35671     NA 1834… &lt;NA&gt;    libe  1804    340.   79.3    NA       NA</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;  8  39935     NA 93041 &lt;NA&gt;    caca  0903    175.   40.6    NA       NA</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  9  38409     NA 2039… &lt;NA&gt;    libe  2009    393.  161.     NA       NA</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 10  18974  18974 1401… 1       libe  1402    274.   23.9 25450        1</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; # … with 4,990 more rows, and 10 more variables: dbh &lt;dbl&gt;, pom &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; #   hom &lt;dbl&gt;, ExactDate &lt;chr&gt;, DFstatus &lt;chr&gt;, codes &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt; #   nostems &lt;dbl&gt;, date &lt;dbl&gt;, status &lt;chr&gt;, agb &lt;dbl&gt;</span></a></code></pre></div>
<p>To match the census data with the best available allometric-equations we need (a) the name of the ForestGEO site (here “scbi”), and (b) each species’ Latin name. But instead of Latin names, ForestGEO’s <em>census</em> tables record species codes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># To search for specific columns in the datasets</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">sp_or_latin &lt;-<span class="st"> "^sp$|^Latin$"</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">census <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(sp_or_latin))</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; # A tibble: 5,000 x 1</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;    sp   </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;    &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  1 nysy </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  2 frni </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  3 caca </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  4 libe </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  5 caca </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  6 libe </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  7 libe </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  8 caca </span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt;  9 libe </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; 10 libe </span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; # … with 4,990 more rows</span></a></code></pre></div>
<p>The species’ Latin names are recorded in <em>species</em> tables.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">species &lt;-<span class="st"> </span>fgeo.biomass<span class="op">::</span>scbi_species</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(sp_or_latin))</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; # A tibble: 73 x 2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;    sp    Latin               </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;               </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  1 acne  Acer negundo        </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  2 acpl  Acer platanoides    </span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  3 acru  Acer rubrum         </span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  4 acsp  Acer sp             </span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  5 aial  Ailanthus altissima </span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  6 amar  Amelanchier arborea </span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;  7 astr  Asimina triloba     </span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;  8 beth  Berberis thunbergii </span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt;  9 caca  Carpinus caroliniana</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; 10 caco  Carya cordiformis   </span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; # … with 63 more rows</span></a></code></pre></div>
<p>We can then add species’ Latin names to the census data by joining the <em>census</em> and <em>species</em> tables. We may do that with <code><a href="https://dplyr.tidyverse.org/reference/join.html">dplyr::left_join()</a></code> but <code><a href="reference/add_species.html">fgeo.biomass::add_species()</a></code> is more specialized.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">census_species &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/add_species.html">add_species</a></span>(species, <span class="st">"scbi"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Adding `site`.</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; Overwriting `sp`; it now stores Latin species names.</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; Adding `rowid`.</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">census_species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(sp_or_latin))</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; # A tibble: 5,000 x 1</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;    sp                  </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;  * &lt;chr&gt;               </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;  1 nyssa sylvatica     </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;  2 fraxinus nigra      </span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;  3 carpinus caroliniana</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;  4 lindera benzoin     </span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;  5 carpinus caroliniana</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  6 lindera benzoin     </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  7 lindera benzoin     </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  8 carpinus caroliniana</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt;  9 lindera benzoin     </span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt; 10 lindera benzoin     </span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt; # … with 4,990 more rows</span></a></code></pre></div>
<div id="finding-the-best-available-allometric-equations" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-the-best-available-allometric-equations" class="anchor"></a>Finding the best available allometric-equations</h3>
<p>Before we added the Latin name of each species to the census data into the <code>sp</code> column. Now we want to find the best available allometric-equations for as many rows as possible with <code><a href="reference/allo_find.html">allo_find()</a></code>. We may not have allometric equations form all species. Although the code will eventually fall back to more general equations, for now we just drop the rows that don’t match the available species for the specified site.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">equations &lt;-<span class="st"> </span>census_species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/allo_find.html">allo_find</a></span>()</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Assuming `dbh` in [mm] (required to find dbh-specific equations).</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; * Matching equations by site and species.</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; * Refining equations according to dbh.</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; * Using generic equations where expert equations can't be found.</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; Warning:   Can't find equations matching these species:</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;   carya sp, quercus prinus, quercus sp, ulmus sp, unidentified unk</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; Warning: Can't find equations for 3285 rows (inserting `NA`).</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">equations</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; # A tibble: 5,030 x 32</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;    rowid treeID stemID tag   StemTag sp    quadrat    gx    gy DBHID</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;    &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  1     1   5665   5665 42179 1       nyss… 0422     78.7 425.   9171</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;  2     2  28317  28317 1907… 1       frax… 1912    378   238.  36867</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;  3     3  17711  17711 1307… 1       carp… 1308    246.  140.  23909</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;  4     4  17546  17546 1305… 1       lind… 1304    245.   75.1 23688</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt;  5     5  10668  10668 90418 1       carp… 0904    168.   77   15257</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt;  6     6   2417   2417 20154 1       lind… 0203     31.4  40.6  5133</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt;  7     7  35671     NA 1834… &lt;NA&gt;    lind… 1804    340.   79.3    NA</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt;  8     8  39935     NA 93041 &lt;NA&gt;    carp… 0903    175.   40.6    NA</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt;  9     9  38409     NA 2039… &lt;NA&gt;    lind… 2009    393.  161.     NA</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; 10    10  18974  18974 1401… 1       lind… 1402    274.   23.9 25450</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; # … with 5,020 more rows, and 22 more variables: CensusID &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; #   dbh &lt;dbl&gt;, pom &lt;chr&gt;, hom &lt;dbl&gt;, ExactDate &lt;chr&gt;, DFstatus &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; #   codes &lt;chr&gt;, nostems &lt;dbl&gt;, date &lt;dbl&gt;, status &lt;chr&gt;, agb &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; #   site &lt;chr&gt;, equation_id &lt;chr&gt;, eqn &lt;chr&gt;, eqn_source &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; #   eqn_type &lt;chr&gt;, anatomic_relevance &lt;chr&gt;, dbh_unit &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; #   bms_unit &lt;chr&gt;, dbh_min_mm &lt;dbl&gt;, dbh_max_mm &lt;dbl&gt;, is_generic &lt;lgl&gt;</span></a></code></pre></div>
</div>
<div id="calculating-biomass" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-biomass" class="anchor"></a>Calculating biomass</h3>
<p>For the rows for which an equation was found in <strong>allodb</strong>, we can now calculate biomass. <code><a href="reference/allo_evaluate.html">allo_evaluate()</a></code> evaluates each allometric equation by replacing the literal string “dbh” with the corresponding value for each row in the <code>dbh</code> column, then doing the actual computation and storing the result in the the new <code>biomass</code> column.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">biomass &lt;-<span class="st"> </span>equations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/allo_evaluate.html">allo_evaluate</a></span>()</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; Assuming `dbh` unit in [mm].</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; Converting `dbh` based on `dbh_unit`.</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; `biomass` values are given in [kg].</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; Warning: Can't convert all units (inserting 3285 missing values):</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; the 'to' argument is not an acceptable unit.</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; Warning: Can't convert all units (inserting 3285 missing values):</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; the 'from' argument is not an acceptable unit.</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; Warning: Can't evaluate all equations (inserting 23 missing values):</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; object 'dba' not found</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; Warning: `biomass` may be invalid. This is still work in progress.</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">biomass</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; # A tibble: 5,000 x 2</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;    rowid biomass</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  1     1   NA   </span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  2     2   44.4 </span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt;  3     3    4.84</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt;  4     4   NA   </span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt;  5     5   NA   </span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;  6     6    8.30</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt;  7     7   NA   </span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt;  8     8   NA   </span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt;  9     9   NA   </span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt; 10    10   NA   </span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; # … with 4,990 more rows</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"></a>
<a class="sourceLine" id="cb8-29" data-line-number="29">with_biomass &lt;-<span class="st"> </span>biomass <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">right_join</a></span>(equations)</a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; Joining, by = "rowid"</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"></a>
<a class="sourceLine" id="cb8-32" data-line-number="32">with_biomass <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(eqn, dbh, biomass)</a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt; # A tibble: 5,030 x 3</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt;    eqn                                dbh biomass</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt;    &lt;chr&gt;                            &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt;  1 &lt;NA&gt;                              35.4   NA   </span></a>
<a class="sourceLine" id="cb8-38" data-line-number="38"><span class="co">#&gt;  2 0.1634 * (dbh^2.348)             109.    44.4 </span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="co">#&gt;  3 exp(-2.48 + 2.4835 * log(dbh))    51.2    4.84</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40"><span class="co">#&gt;  4 &lt;NA&gt;                              20.4   NA   </span></a>
<a class="sourceLine" id="cb8-41" data-line-number="41"><span class="co">#&gt;  5 &lt;NA&gt;                              15.8   NA   </span></a>
<a class="sourceLine" id="cb8-42" data-line-number="42"><span class="co">#&gt;  6 exp(-2.2118 + 2.4133 * log(dbh))  60.1    8.30</span></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="co">#&gt;  7 &lt;NA&gt;                              NA     NA   </span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44"><span class="co">#&gt;  8 &lt;NA&gt;                              NA     NA   </span></a>
<a class="sourceLine" id="cb8-45" data-line-number="45"><span class="co">#&gt;  9 &lt;NA&gt;                              NA     NA   </span></a>
<a class="sourceLine" id="cb8-46" data-line-number="46"><span class="co">#&gt; 10 &lt;NA&gt;                              10.8   NA   </span></a>
<a class="sourceLine" id="cb8-47" data-line-number="47"><span class="co">#&gt; # … with 5,020 more rows</span></a></code></pre></div>
<p>Commonly we would further summarize the result. For that you can use the <strong>dplyr</strong> package or any general purpose tool. For example, this summary gives the total biomass for each species in descending order.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">with_biomass <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(sp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">total_biomass =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(biomass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(total_biomass))</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; # A tibble: 52 x 2</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;    sp                      total_biomass</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;    &lt;chr&gt;                           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt;  1 liriodendron tulipifera       142493.</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;  2 quercus velutina              104338.</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;  3 carya glabra                   37757.</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  4 quercus alba                   36999.</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  5 fraxinus americana             23585.</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  6 carya tomentosa                23136.</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  7 juglans nigra                  22559.</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  8 carya ovalis                   15738.</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;  9 quercus rubra                  13971.</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; 10 nyssa sylvatica                 8238.</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; # … with 42 more rows</span></a></code></pre></div>
</div>
<div id="issues" class="section level3">
<h3 class="hasAnchor">
<a href="#issues" class="anchor"></a>Issues</h3>
<p>Our progress is recorded in this <a href="https://github.com/forestgeo/allodb/projects/4">Kanban project board</a>. Because we still don’t support some features, the the biomass result currently is invalid and excludes some trees.</p>
<p>Issues that result in invalid biomass:</p>
<ul>
<li>We still don’t handle units correctly (<a href="https://github.com/forestgeo/allodb/issues/42" class="uri">https://github.com/forestgeo/allodb/issues/42</a>).</li>
</ul>
<p>Issues that result in data loss:</p>
<ul>
<li><p>The output excludes equations that apply to only part of a tree instead of the whole tree (<a href="https://github.com/forestgeo/allodb/issues/63" class="uri">https://github.com/forestgeo/allodb/issues/63</a>, <a href="https://github.com/forestgeo/fgeo.biomass/issues/9" class="uri">https://github.com/forestgeo/fgeo.biomass/issues/9</a>).</p></li>
<li><p>We exclude equations from shrubs (<a href="https://github.com/forestgeo/allodb/issues/41" class="uri">https://github.com/forestgeo/allodb/issues/41</a>).</p></li>
</ul>
</div>
</div>
<div id="general-information" class="section level2">
<h2 class="hasAnchor">
<a href="#general-information" class="anchor"></a>General information</h2>
<ul>
<li>
<a href="SUPPORT.html">Getting help</a>.</li>
<li>
<a href="CONTRIBUTING.html">Contributing</a>.</li>
<li>
<a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>.</li>
</ul>
</div>
<div id="related-project" class="section level2">
<h2 class="hasAnchor">
<a href="#related-project" class="anchor"></a>Related project</h2>
<ul>
<li><a href="https://CRAN.R-project.org/package=BIOMASS">BIOMASS</a></li>
</ul>
<pre><code>A BibTeX entry for LaTeX users is

  @Article{,
    title = {BIOMASS : an {R} package for estimating above-ground biomass and its uncertainty in tropical forests},
    volume = {8},
    issn = {2041210X},
    url = {http://doi.wiley.com/10.1111/2041-210X.12753},
    doi = {10.1111/2041-210X.12753},
    language = {en},
    number = {9},
    urldate = {2018-12-13},
    journal = {Methods in Ecology and Evolution},
    author = {Maxime Rejou-Mechain and Ariane Tanguy and Camille Piponiot and Jerome Chave and Bruno Herault},
    editor = {Sarah Goslee},
    year = {2017},
  }</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/forestgeo/fgeo.biomass">https://​github.com/​forestgeo/​fgeo.biomass</a>
</li>
<li>Report a bug at <br><a href="https://github.com/forestgeo/fgeo.biomass/issues">https://​github.com/​forestgeo/​fgeo.biomass/​issues</a>
</li>
<li>Learn more about ForestGEO at <br><a href="http://www.forestgeo.si.edu/">http://​www.forestgeo.si.edu/​</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/maurolepore">Mauro Lepore</a> <br><small class="roles"> Author, contractor, maintainer </small> <a href="https://orcid.org/0000-0002-1986-7988" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
<li>
<a href="https://forestgeo.si.edu/arellano-gabriel">Gabriel Arellano</a> <br><small class="roles"> Author, reviewer </small>  </li>
<li>
<a href="https://forestgeo.si.edu/stuart-j-davies">Stuart Davies</a> <br><small class="roles"> Author, reviewer </small>  </li>
<li>
<a href="https://github.com/gonzalezeb">Erika Gonzalez</a> <br><small class="roles"> Author, reviewer </small> <a href="https://orcid.org/0000-0001-8305-6672" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
<li>
<a href="https://forestgeo.si.edu/sean-mcmahon">Sean McMahon</a> <br><small class="roles"> Author, reviewer </small>  </li>
<li>Kristina Anderson-Teixeira <br><small class="roles"> Author, reviewer </small>  </li>
<li>
<a href="http://www.forestgeo.si.edu/">CTFS-ForestGEO</a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
<li><a href="https://travis-ci.org/forestgeo/fgeo.biomass"><img src="https://travis-ci.org/forestgeo/fgeo.biomass.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://coveralls.io/r/forestgeo/fgeo.biomass?branch=master"><img src="https://coveralls.io/repos/github/forestgeo/fgeo.biomass/badge.svg" alt="Coverage status"></a></li>
<li><a href="https://cran.r-project.org/package=fgeo.biomass"><embed src="https://www.r-pkg.org/badges/version/fgeo.biomass"></embed></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/maurolepore">Mauro Lepore</a>, <a href="https://forestgeo.si.edu/arellano-gabriel">Gabriel Arellano</a>, <a href="https://forestgeo.si.edu/stuart-j-davies">Stuart Davies</a>, <a href="https://github.com/gonzalezeb">Erika Gonzalez</a>, <a href="https://forestgeo.si.edu/sean-mcmahon">Sean McMahon</a>, Kristina Anderson-Teixeira, <a href="http://www.forestgeo.si.edu/">CTFS-ForestGEO</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
